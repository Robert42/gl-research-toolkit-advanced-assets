#include "uuids.as"
#include "common/textures/uuids.as"

void registerTextures(ResourceIndex@ index)
{
  TextureSampler samplerInterpolated;
  
  TextureImportSettings importNormalMap;
  importNormalMap.format = TextureFormat::RGB;
  importNormalMap.type = TextureType::INT8;
  importNormalMap.sourceIsNormalMap = true;
  
  index.convertTexture(textureFile: "sponza_floor_a_n.texture", sourceFile: "textures/sponza_floor_a_n.png", settings: importNormalMap);
  index.registerTextureFile(uuid: uuids::sponza::textures::sponza_floor_a_basic_color,
                            file: "sponza_floor_a_n.texture",
                            defaultSampler: samplerInterpolated);
}

void registerMaterials(ResourceIndex@ index)
{
  TexturedMaterial dummyMaterial;
  
  TexturedMaterial dummyMaskedTwoSidedMaterial;
  dummyMaskedTwoSidedMaterial.masked = true;
  dummyMaskedTwoSidedMaterial.two_sided = true;
  
  PlainColorMaterial debuggingText;
  debuggingText.base_color = vec3(0);
  debuggingText.emission = vec3(1);
  
  
  index.registerMaterial(uuid: uuids::sponza::materials::details,
                         material: dummyMaterial);
  
  index.registerMaterial(uuid: uuids::sponza::materials::bricks,
                         material: dummyMaterial);
  
  index.registerMaterial(uuid: uuids::sponza::materials::column_a,
                         material: dummyMaterial);
  
  index.registerMaterial(uuid: uuids::sponza::materials::column_b,
                         material: dummyMaterial);
  
  index.registerMaterial(uuid: uuids::sponza::materials::column_c,
                         material: dummyMaterial);
  
  index.registerMaterial(uuid: uuids::sponza::materials::ceiling,
                         material: dummyMaterial);
  
  index.registerMaterial(uuid: uuids::sponza::materials::arch,
                         material: dummyMaterial);
  
  index.registerMaterial(uuid: uuids::sponza::materials::roof,
                         material: dummyMaterial);
                         
  TexturedMaterial floor_material;
  //floor_material.basecolor_map = TextureHandle(uuids::sponza::textures::sponza_floor_a_basic_color);
  floor_material.normal_map = TextureHandle(uuids::sponza::textures::sponza_floor_a_n);
  //floor_material.height_map = TextureHandle(uuids::sponza::textures::sponza_floor_a_bump);
  //floor_material.srmo_map = TextureHandle(uuids::sponza::textures::sponza_floor_a_srmo);
                           
  index.registerMaterial(uuid: uuids::sponza::materials::floor,
                         material: floor_material);
  
  index.registerMaterial(uuid: uuids::sponza::materials::flagpole,
                         material: dummyMaterial);
  
  index.registerMaterial(uuid: uuids::sponza::materials::vase_hanging,
                         material: dummyMaterial);
  
  index.registerMaterial(uuid: uuids::sponza::materials::chain,
                         material: dummyMaskedTwoSidedMaterial);
  
  index.registerMaterial(uuid: uuids::sponza::materials::vase,
                         material: dummyMaterial);
  
  index.registerMaterial(uuid: uuids::sponza::materials::vase_round,
                         material: dummyMaterial);
  
  index.registerMaterial(uuid: uuids::sponza::materials::vase_foliage,
                         material: dummyMaskedTwoSidedMaterial);
  
  index.registerMaterial(uuid: uuids::sponza::materials::fabric_a,
                         material: dummyMaterial);
  
  index.registerMaterial(uuid: uuids::sponza::materials::fabric_b,
                         material: dummyMaterial);
  
  index.registerMaterial(uuid: uuids::sponza::materials::fabric_c,
                         material: dummyMaterial);
  
  index.registerMaterial(uuid: uuids::sponza::materials::fabric_d,
                         material: dummyMaterial);
  
  index.registerMaterial(uuid: uuids::sponza::materials::fabric_e,
                         material: dummyMaterial);
  
  index.registerMaterial(uuid: uuids::sponza::materials::fabric_f,
                         material: dummyMaterial);
  
  index.registerMaterial(uuid: uuids::sponza::materials::fabric_g,
                         material: dummyMaterial);
  
  index.registerMaterial(uuid: uuids::sponza::materials::leaf,
                         material: dummyMaskedTwoSidedMaterial);
  
  index.registerMaterial(uuid: uuids::sponza::materials::lion_shield,
                         material: dummyMaterial);
  
  index.registerMaterial(uuid: uuids::sponza::materials::lion,
                         material: dummyMaterial);
  
  index.registerMaterial(uuid: uuids::sponza::materials::strange_plate,
                         material: dummyMaterial);
  
  
  TexturedMaterial material_test;
  material_test.basecolor_map = TextureHandle(uuids::textures::fruit_plate_256x256);
  index.registerMaterial(uuid: uuids::sponza::materials::material_test,
                         material: material_test);
  
  index.registerMaterial(uuid: uuids::sponza::materials::texture_frame_test,
                         material: debuggingText);
}

void registerScene(ResourceIndex@ index)
{
  SceneGraphImportSettings importSettings;
  
  importSettings.materialUuids['details'] = uuids::sponza::materials::details;
  importSettings.materialUuids['bricks'] = uuids::sponza::materials::bricks;
  importSettings.materialUuids['column_a'] = uuids::sponza::materials::column_a;
  importSettings.materialUuids['column_b'] = uuids::sponza::materials::column_b;
  importSettings.materialUuids['column_c'] = uuids::sponza::materials::column_c;
  importSettings.materialUuids['ceiling'] = uuids::sponza::materials::ceiling;
  importSettings.materialUuids['arch'] = uuids::sponza::materials::arch;
  importSettings.materialUuids['roof'] = uuids::sponza::materials::roof;
  importSettings.materialUuids['floor'] = uuids::sponza::materials::floor;
  importSettings.materialUuids['flagpole'] = uuids::sponza::materials::flagpole;
  importSettings.materialUuids['vase_hanging'] = uuids::sponza::materials::vase_hanging;
  importSettings.materialUuids['chain'] = uuids::sponza::materials::chain;
  importSettings.materialUuids['vase'] = uuids::sponza::materials::vase;
  importSettings.materialUuids['vase_round'] = uuids::sponza::materials::vase_round;
  importSettings.materialUuids['vase_foliage'] = uuids::sponza::materials::vase_foliage;
  importSettings.materialUuids['fabric_a'] = uuids::sponza::materials::fabric_a;
  importSettings.materialUuids['fabric_b'] = uuids::sponza::materials::fabric_b;
  importSettings.materialUuids['fabric_c'] = uuids::sponza::materials::fabric_c;
  importSettings.materialUuids['fabric_d'] = uuids::sponza::materials::fabric_d;
  importSettings.materialUuids['fabric_e'] = uuids::sponza::materials::fabric_e;
  importSettings.materialUuids['fabric_f'] = uuids::sponza::materials::fabric_f;
  importSettings.materialUuids['fabric_g'] = uuids::sponza::materials::fabric_g;
  importSettings.materialUuids['leaf'] = uuids::sponza::materials::leaf;
  importSettings.materialUuids['lion_shield'] = uuids::sponza::materials::lion_shield;
  importSettings.materialUuids['lion'] = uuids::sponza::materials::lion;
  importSettings.materialUuids['strange-plate'] = uuids::sponza::materials::strange_plate;
  importSettings.materialUuids['material-test'] = uuids::sponza::materials::material_test;
  importSettings.materialUuids['texture-frame-text'] = uuids::sponza::materials::texture_frame_test;
  
  index.label[uuids::sponza::materials::details] = 'details';
  index.label[uuids::sponza::materials::bricks] = 'bricks';
  index.label[uuids::sponza::materials::column_a] = 'column_a';
  index.label[uuids::sponza::materials::column_b] = 'column_b';
  index.label[uuids::sponza::materials::column_c] = 'column_c';
  index.label[uuids::sponza::materials::ceiling] = 'ceiling';
  index.label[uuids::sponza::materials::arch] = 'arch';
  index.label[uuids::sponza::materials::roof] = 'roof';
  index.label[uuids::sponza::materials::floor] = 'floor';
  index.label[uuids::sponza::materials::flagpole] = 'flagpole';
  index.label[uuids::sponza::materials::vase_hanging] = 'vase_hanging';
  index.label[uuids::sponza::materials::chain] = 'chain';
  index.label[uuids::sponza::materials::vase] = 'vase';
  index.label[uuids::sponza::materials::vase_round] = 'vase_round';
  index.label[uuids::sponza::materials::vase_foliage] = 'vase_foliage';
  index.label[uuids::sponza::materials::fabric_a] = 'fabric_a';
  index.label[uuids::sponza::materials::fabric_b] = 'fabric_b';
  index.label[uuids::sponza::materials::fabric_c] = 'fabric_c';
  index.label[uuids::sponza::materials::fabric_d] = 'fabric_d';
  index.label[uuids::sponza::materials::fabric_e] = 'fabric_e';
  index.label[uuids::sponza::materials::fabric_f] = 'fabric_f';
  index.label[uuids::sponza::materials::fabric_g] = 'fabric_g';
  index.label[uuids::sponza::materials::leaf] = 'leaf';
  index.label[uuids::sponza::materials::lion_shield] = 'lion_shield';
  index.label[uuids::sponza::materials::lion] = 'lion';
  index.label[uuids::sponza::materials::strange_plate] = 'strange-plate';
  index.label[uuids::sponza::materials::material_test] = 'material-test';
  index.label[uuids::sponza::materials::texture_frame_test] = 'texture-frame-text';
    
  importSettings.cameraUuids['EyeHeight'] = uuids::sponza::cameras::eyeHeight;
  importSettings.lightUuids['Sun'] = uuids::sponza::lights::sunLight;
  
  index.convertSceneGraph(sceneGraphFile: "sponza-scenery.scene-graph",
                          sourceFile: "sponza.blend",
                          groupToImport: "scenery",
                          settings: importSettings);
  index.convertSceneGraph(sceneGraphFile: "sponza-building.scene-graph",
                          sourceFile: "sponza.blend",
                          groupToImport: "sponza-building",
                          settings: importSettings);
  index.convertSceneGraph(sceneGraphFile: "sponza-decoration.scene-graph",
                          sourceFile: "sponza.blend",
                          groupToImport: "sponza-decoraton",
                          settings: importSettings);
  index.convertSceneGraph(sceneGraphFile: "sponza-fabrics.scene-graph",
                          sourceFile: "sponza.blend",
                          groupToImport: "sponza-fabrics",
                          settings: importSettings);
  index.convertSceneGraph(sceneGraphFile: "sponza-foliage.scene-graph",
                          sourceFile: "sponza.blend",
                          groupToImport: "sponza-foliage",
                          settings: importSettings);
  index.convertSceneGraph(sceneGraphFile: "sponza-unmovable-decoration.scene-graph",
                          sourceFile: "sponza.blend",
                          groupToImport: "sponza-unmovable-decoraton",
                          settings: importSettings);
  index.convertSceneGraph(sceneGraphFile: "texture-frame.scene-graph",
                          sourceFile: "sponza-debugging-helpers.blend",
                          groupToImport: "texture-frame",
                          settings: importSettings);
                          
  index.registerSceneLayerFile(uuid: uuids::sponza::sceneLayers::sponza_scenery,
                               file: "sponza-scenery.scene-layer");
  index.registerSceneLayerFile(uuid: uuids::sponza::sceneLayers::sponza_building,
                               file: "sponza-building.scene-layer");
  index.registerSceneLayerFile(uuid: uuids::sponza::sceneLayers::sponza_decoration,
                               file: "sponza-decoration.scene-layer");
  index.registerSceneLayerFile(uuid: uuids::sponza::sceneLayers::sponza_fabrics,
                               file: "sponza-fabrics.scene-layer");
  index.registerSceneLayerFile(uuid: uuids::sponza::sceneLayers::sponza_foliage,
                               file: "sponza-foliage.scene-layer");
  index.registerSceneLayerFile(uuid: uuids::sponza::sceneLayers::sponza_unmovable_decoration,
                               file: "sponza-unmovable-decoration.scene-layer");
  index.registerSceneLayerFile(uuid: uuids::sponza::sceneLayers::sponza_material_debugging,
                               file: "sponza-material-debugging.scene-layer");
  
  index.registerSceneFile(uuid: uuids::sponza::scenes::sponza_full,
                          file: "sponza-full.scene");
}

void registerLights(ResourceIndex@ index)
{
  SphereAreaLightSource sphereAreaLight;
  sphereAreaLight.radius = 3.0;
  sphereAreaLight.luminous_power *= 10000000;
  
  index.registerLightSource(uuid: uuids::sponza::lights::sunLight,
                            light: sphereAreaLight);
}

void main(ResourceIndex@ index)
{
  registerTextures(index);
  registerMaterials(index);
  registerScene(index);
  registerLights(index);
}
